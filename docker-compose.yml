services:
  # ==================== DATABASES ====================
  auth-db:
    image: mysql:8.4
    container_name: auth-db
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD:-rootpass}
      MYSQL_DATABASE: auth_db
      TZ: Asia/Ho_Chi_Minh
    command: --default-time-zone='+07:00'
    ports:
      - "3307:3306"
    volumes:
      - auth-db-data:/var/lib/mysql
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-uroot", "-p${MYSQL_ROOT_PASSWORD:-rootpass}"]
      interval: 10s
      timeout: 5s
      retries: 10
      start_period: 30s
    networks:
      - ecommerce-network
    restart: unless-stopped

  product-db:
    image: mysql:8.4
    container_name: product-db
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD:-rootpass}
      MYSQL_DATABASE: product_db
      TZ: Asia/Ho_Chi_Minh
    command: --default-time-zone='+07:00'
    ports:
      - "3308:3306"
    volumes:
      - product-db-data:/var/lib/mysql
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-uroot", "-p${MYSQL_ROOT_PASSWORD:-rootpass}"]
      interval: 10s
      timeout: 5s
      retries: 10
      start_period: 30s
    networks:
      - ecommerce-network
    restart: unless-stopped

  # ==================== DATABASES (PHẦN BỊ THIẾU) ====================
  order-db:
    image: mysql:8.4
    container_name: order-db
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD:-rootpass}
      MYSQL_DATABASE: order_db
      TZ: Asia/Ho_Chi_Minh
    command: --default-time-zone='+07:00'
    ports:
      - "3309:3306"
    volumes:
      - order-db-data:/var/lib/mysql
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-uroot", "-p${MYSQL_ROOT_PASSWORD:-rootpass}"]
      interval: 10s
      timeout: 5s
      retries: 10
      start_period: 30s
    networks:
      - ecommerce-network
    restart: unless-stopped

  inventory-db:
    image: mysql:8.4
    container_name: inventory-db
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD:-rootpass}
      MYSQL_DATABASE: inventory_db
      TZ: Asia/Ho_Chi_Minh
    command: --default-time-zone='+07:00'
    ports:
      - "3310:3306"
    volumes:
      - inventory-db-data:/var/lib/mysql
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-uroot", "-p${MYSQL_ROOT_PASSWORD:-rootpass}"]
      interval: 10s
      timeout: 5s
      retries: 10
      start_period: 30s
    networks:
      - ecommerce-network
    restart: unless-stopped

  cart-db:
    image: mysql:8.4
    container_name: cart-db
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD:-rootpass}
      MYSQL_DATABASE: cart_db
      TZ: Asia/Ho_Chi_Minh
    command: --default-time-zone='+07:00'
    ports:
      - "3311:3306"
    volumes:
      - cart-db-data:/var/lib/mysql
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-uroot", "-p${MYSQL_ROOT_PASSWORD:-rootpass}"]
      interval: 10s
      timeout: 5s
      retries: 10
      start_period: 30s
    networks:
      - ecommerce-network
    restart: unless-stopped

  notification-db:
    image: mysql:8.4
    container_name: notification-db
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD:-rootpass}
      MYSQL_DATABASE: notification_db
      TZ: Asia/Ho_Chi_Minh
    command: --default-time-zone='+07:00'
    ports:
      - "3312:3306"
    volumes:
      - notification-db-data:/var/lib/mysql
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-uroot", "-p${MYSQL_ROOT_PASSWORD:-rootpass}"]
      interval: 10s
      timeout: 5s
      retries: 10
      start_period: 30s
    networks:
      - ecommerce-network
    restart: unless-stopped

  payment-db:
    image: mysql:8.4
    container_name: payment-db
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD:-rootpass}
      MYSQL_DATABASE: payment_db
      TZ: Asia/Ho_Chi_Minh
    command: --default-time-zone='+07:00'
    ports:
      - "3313:3306"
    volumes:
      - payment-db-data:/var/lib/mysql
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-uroot", "-p${MYSQL_ROOT_PASSWORD:-rootpass}"]
      interval: 10s
      timeout: 5s
      retries: 10
      start_period: 30s
    networks:
      - ecommerce-network
    restart: unless-stopped

  # ==================== REDIS ====================
  redis:
    image: redis:7
    container_name: redis-cache
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    command: >
      redis-server 
      --appendonly yes 
      --requirepass ${REDIS_PASSWORD:-password}
      --databases 16
      --maxmemory 512mb
      --maxmemory-policy allkeys-lru
      --tcp-keepalive 60
    healthcheck:
      test: ["CMD", "redis-cli", "--no-auth-warning", "-a", "${REDIS_PASSWORD:-password}", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    networks:
      - ecommerce-network
    restart: unless-stopped

  # ==================== ZOOKEEPER ====================
  zookeeper:
    image: confluentinc/cp-zookeeper:7.5.0
    container_name: zookeeper
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
      ZOOKEEPER_TICK_TIME: 2000
    ports:
      - "2181:2181"
    networks:
      - ecommerce-network
    restart: unless-stopped

  # ==================== KAFKA ====================
  kafka:
    image: confluentinc/cp-kafka:7.5.0
    container_name: kafka
    depends_on:
      - zookeeper
    ports:
      - "9092:9092"
      - "9093:9093"
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://localhost:9092,PLAINTEXT_INTERNAL://kafka:9093
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_INTERNAL:PLAINTEXT
      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT_INTERNAL
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
      KAFKA_AUTO_CREATE_TOPICS_ENABLE: "true"
    healthcheck:
      test: ["CMD", "kafka-broker-api-versions", "--bootstrap-server", "localhost:9092"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 60s
    networks:
      - ecommerce-network
    restart: unless-stopped

  # ==================== EUREKA SERVER (COMMENT - CHẠY TRÊN INTELLIJ IDEA) ====================
  # eureka-server:
  #   build:
  #     context: ./eureka-server
  #     dockerfile: Dockerfile
  #   container_name: eureka-server
  #   ports:
  #     - "8761:8761"
  #     - "9099:9099"
  #   environment:
  #     SPRING_APPLICATION_NAME: eureka-server
  #     SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-prod}
  #   healthcheck:
  #     test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:9099/actuator/health"]
  #     interval: 15s
  #     timeout: 10s
  #     retries: 10
  #     start_period: 40s
  #   networks:
  #     - ecommerce-network
  #   restart: unless-stopped

  # ==================== AUTH SERVICE (COMMENT - CHẠY TRÊN INTELLIJ IDEA) ====================
  # auth-service:
  #   build:
  #     context: ./auth-service
  #     dockerfile: Dockerfile
  #   container_name: auth-service
  #   ports:
  #     - "8081:8080"
  #     - "9091:9091"
  #   environment:
  #     # Spring Profile
  #     SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-prod}
  #
  #     # Database Connection
  #     SPRING_DATASOURCE_URL: jdbc:mysql://auth-db:3306/auth_db?createDatabaseIfNotExist=true&allowPublicKeyRetrieval=true&useSSL=false&serverTimezone=Asia/Ho_Chi_Minh
  #     # Timezone Configuration
  #     TZ: Asia/Ho_Chi_Minh
  #     USER_TIMEZONE: Asia/Ho_Chi_Minh
  #     SPRING_DATASOURCE_USERNAME: root
  #     SPRING_DATASOURCE_PASSWORD: ${MYSQL_ROOT_PASSWORD:-rootpass}
  #
  #     # Redis Connection (DB 0 - Sessions & Tokens)
  #     SPRING_DATA_REDIS_HOST: redis-cache
  #     SPRING_DATA_REDIS_PORT: 6379
  #     SPRING_DATA_REDIS_PASSWORD: ${REDIS_PASSWORD:-password}
  #     SPRING_DATA_REDIS_DATABASE: 0
  #
  #     # Eureka Discovery
  #     EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: http://eureka-server:8761/eureka/
  #     EUREKA_INSTANCE_PREFER_IP_ADDRESS: true
  #
  #     # JWT Configuration
  #     JWT_SECRET: ${JWT_SECRET}
  #     JWT_ACCESS_TOKEN_EXPIRATION: ${JWT_ACCESS_TOKEN_EXPIRATION:-3600}
  #     JWT_REFRESH_TOKEN_EXPIRATION: ${JWT_REFRESH_TOKEN_EXPIRATION:-86400}
  #
  #     GATEWAY_SECRET: ${GATEWAY_SECRET}
  #
  #     # AWS Configuration
  #     AWS_ACCESS_KEY: ${AWS_ACCESS_KEY}
  #     AWS_SECRET_KEY: ${AWS_SECRET_KEY}
  #     AWS_REGION: ${AWS_REGION:-ap-southeast-1}
  #     AWS_S3_BUCKET_NAME: ${AWS_S3_BUCKET_NAME}
  #
  #     # Mail Configuration
  #     SPRING_MAIL_HOST: ${MAIL_HOST:-smtp.gmail.com}
  #     SPRING_MAIL_PORT: ${MAIL_PORT:-587}
  #     SPRING_MAIL_USERNAME: ${MAIL_USERNAME}
  #     SPRING_MAIL_PASSWORD: ${MAIL_PASSWORD}
  #     MAIL_FROM: ${MAIL_FROM}
  #   depends_on:
  #     eureka-server:
  #       condition: service_healthy
  #     auth-db:
  #       condition: service_healthy
  #     redis:
  #       condition: service_healthy
  #   healthcheck:
  #     test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:9091/actuator/health"]
  #     interval: 20s
  #     timeout: 10s
  #     retries: 5
  #     start_period: 60s
  #   networks:
  #     - ecommerce-network
  #   restart: unless-stopped

  # ==================== PRODUCT SERVICE (COMMENT - CHẠY TRÊN INTELLIJ IDEA) ====================
  # product-service:
  #   build:
  #     context: ./product-service
  #     dockerfile: Dockerfile
  #   container_name: product-service
  #   ports:
  #     - "8082:8080"
  #     - "9100:9092"
  #   environment:
  #     # Spring Profile
  #     SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-prod}
  #
  #     # Database Connection
  #     SPRING_DATASOURCE_URL: jdbc:mysql://product-db:3306/product_db?createDatabaseIfNotExist=true&allowPublicKeyRetrieval=true&useSSL=false&serverTimezone=Asia/Ho_Chi_Minh
  #     # Timezone Configuration
  #     TZ: Asia/Ho_Chi_Minh
  #     USER_TIMEZONE: Asia/Ho_Chi_Minh
  #     SPRING_DATASOURCE_USERNAME: root
  #     SPRING_DATASOURCE_PASSWORD: ${MYSQL_ROOT_PASSWORD:-rootpass}
  #
  #     # Eureka Discovery
  #     EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: http://eureka-server:8761/eureka/
  #     EUREKA_INSTANCE_PREFER_IP_ADDRESS: true
  #
  #     # JWT Configuration (Cần để validate và đọc thông tin từ JWT token)
  #     JWT_SECRET: ${JWT_SECRET}
  #     JWT_ACCESS_TOKEN_EXPIRATION: ${JWT_ACCESS_TOKEN_EXPIRATION:-3600}
  #     JWT_REFRESH_TOKEN_EXPIRATION: ${JWT_REFRESH_TOKEN_EXPIRATION:-86400}
  #
  #     # Gateway Security
  #     GATEWAY_SECRET: ${GATEWAY_SECRET}
  #
  #     # AWS Configuration
  #     AWS_ACCESS_KEY: ${AWS_ACCESS_KEY}
  #     AWS_SECRET_KEY: ${AWS_SECRET_KEY}
  #     AWS_REGION: ${AWS_REGION:-ap-southeast-1}
  #     AWS_S3_BUCKET_NAME: ${AWS_S3_BUCKET_NAME}
  #
  #     # Redis Connection (DB 1 - Product Cache)
  #     SPRING_DATA_REDIS_HOST: redis-cache
  #     SPRING_DATA_REDIS_PORT: 6379
  #     SPRING_DATA_REDIS_PASSWORD: ${REDIS_PASSWORD:-password}
  #     SPRING_DATA_REDIS_DATABASE: 1
  #   depends_on:
  #     eureka-server:
  #       condition: service_healthy
  #     product-db:
  #       condition: service_healthy
  #     redis:
  #       condition: service_healthy
  #   healthcheck:
  #     test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:9092/actuator/health"]
  #     interval: 20s
  #     timeout: 10s
  #     retries: 5
  #     start_period: 60s
  #   networks:
  #     - ecommerce-network
  #   restart: unless-stopped

  # ==================== ORDER SERVICE (COMMENT - CHẠY TRÊN INTELLIJ IDEA) ====================
  # order-service:
  #   build:
  #     context: ./order-service
  #     dockerfile: Dockerfile
  #   container_name: order-service
  #   ports:
  #     - "8083:8080"
  #     - "9096:9093"
  #   environment:
  #     # Spring Profile
  #     SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-prod}
  #
  #     # Database Connection
  #     SPRING_DATASOURCE_URL: jdbc:mysql://order-db:3306/order_db?createDatabaseIfNotExist=true&allowPublicKeyRetrieval=true&useSSL=false&serverTimezone=Asia/Ho_Chi_Minh
  #     # Timezone Configuration
  #     TZ: Asia/Ho_Chi_Minh
  #     USER_TIMEZONE: Asia/Ho_Chi_Minh
  #     SPRING_DATASOURCE_USERNAME: root
  #     SPRING_DATASOURCE_PASSWORD: ${MYSQL_ROOT_PASSWORD:-rootpass}
  #
  #     # Eureka Discovery
  #     EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: http://eureka-server:8761/eureka/
  #     EUREKA_INSTANCE_PREFER_IP_ADDRESS: true
  #
  #     # JWT Configuration (Cần để validate và đọc thông tin từ JWT token)
  #     JWT_SECRET: ${JWT_SECRET}
  #     JWT_ACCESS_TOKEN_EXPIRATION: ${JWT_ACCESS_TOKEN_EXPIRATION:-3600}
  #     JWT_REFRESH_TOKEN_EXPIRATION: ${JWT_REFRESH_TOKEN_EXPIRATION:-86400}
  #
  #     # Gateway Security
  #     GATEWAY_SECRET: ${GATEWAY_SECRET}
  #
  #     # Kafka Configuration
  #     KAFKA_BOOTSTRAP_SERVERS: kafka:9093
  #   depends_on:
  #     eureka-server:
  #       condition: service_healthy
  #     order-db:
  #       condition: service_healthy
  #     kafka:
  #       condition: service_healthy
  #   healthcheck:
  #     test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:9093/actuator/health"]
  #     interval: 20s
  #     timeout: 10s
  #     retries: 5
  #     start_period: 60s
  #   networks:
  #     - ecommerce-network
  #   restart: unless-stopped

  # ==================== INVENTORY SERVICE (COMMENT - CHẠY TRÊN INTELLIJ IDEA) ====================
  # inventory-service:
  #   build:
  #     context: ./inventory-service
  #     dockerfile: Dockerfile
  #   container_name: inventory-service
  #   ports:
  #     - "8084:8080"
  #     - "9094:9094"
  #   environment:
  #     # Spring Profile
  #     SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-prod}
  #
  #     # Database Connection
  #     SPRING_DATASOURCE_URL: jdbc:mysql://inventory-db:3306/inventory_db?createDatabaseIfNotExist=true&allowPublicKeyRetrieval=true&useSSL=false&serverTimezone=Asia/Ho_Chi_Minh
  #     # Timezone Configuration
  #     TZ: Asia/Ho_Chi_Minh
  #     USER_TIMEZONE: Asia/Ho_Chi_Minh
  #     SPRING_DATASOURCE_USERNAME: root
  #     SPRING_DATASOURCE_PASSWORD: ${MYSQL_ROOT_PASSWORD:-rootpass}
  #
  #     # Eureka Discovery
  #     EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: http://eureka-server:8761/eureka/
  #     EUREKA_INSTANCE_PREFER_IP_ADDRESS: true
  #
  #     # JWT Configuration (Cần để validate và đọc thông tin từ JWT token)
  #     JWT_SECRET: ${JWT_SECRET}
  #     JWT_ACCESS_TOKEN_EXPIRATION: ${JWT_ACCESS_TOKEN_EXPIRATION:-3600}
  #     JWT_REFRESH_TOKEN_EXPIRATION: ${JWT_REFRESH_TOKEN_EXPIRATION:-86400}
  #
  #     # Gateway Security
  #     GATEWAY_SECRET: ${GATEWAY_SECRET}
  #
  #     # Kafka Configuration
  #     KAFKA_BOOTSTRAP_SERVERS: kafka:9093
  #   depends_on:
  #     eureka-server:
  #       condition: service_healthy
  #     inventory-db:
  #       condition: service_healthy
  #     kafka:
  #       condition: service_healthy
  #   healthcheck:
  #     test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:9094/actuator/health"]
  #     interval: 20s
  #     timeout: 10s
  #     retries: 5
  #     start_period: 60s
  #   networks:
  #     - ecommerce-network
  #   restart: unless-stopped

  # ==================== CART SERVICE (COMMENT - CHẠY TRÊN INTELLIJ IDEA) ====================
  # cart-service:
  #   build:
  #     context: ./cart-service
  #     dockerfile: Dockerfile
  #   container_name: cart-service
  #   ports:
  #     - "8085:8080"
  #     - "9095:9095"
  #   environment:
  #     # Spring Profile
  #     SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-prod}
  #
  #     # Database Connection
  #     SPRING_DATASOURCE_URL: jdbc:mysql://cart-db:3306/cart_db?createDatabaseIfNotExist=true&allowPublicKeyRetrieval=true&useSSL=false&serverTimezone=Asia/Ho_Chi_Minh
  #     # Timezone Configuration
  #     TZ: Asia/Ho_Chi_Minh
  #     USER_TIMEZONE: Asia/Ho_Chi_Minh
  #     SPRING_DATASOURCE_USERNAME: root
  #     SPRING_DATASOURCE_PASSWORD: ${MYSQL_ROOT_PASSWORD:-rootpass}
  #
  #
  #     # Eureka Discovery
  #     EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: http://eureka-server:8761/eureka/
  #     EUREKA_INSTANCE_PREFER_IP_ADDRESS: true
  #
  #     # JWT Configuration (Cần để validate và đọc thông tin từ JWT token)
  #     JWT_SECRET: ${JWT_SECRET}
  #     JWT_ACCESS_TOKEN_EXPIRATION: ${JWT_ACCESS_TOKEN_EXPIRATION:-3600}
  #     JWT_REFRESH_TOKEN_EXPIRATION: ${JWT_REFRESH_TOKEN_EXPIRATION:-86400}
  #
  #     # Gateway Security
  #     GATEWAY_SECRET: ${GATEWAY_SECRET}
  #
  #     # Kafka Configuration
  #     KAFKA_BOOTSTRAP_SERVERS: kafka:9093
  #   depends_on:
  #     eureka-server:
  #       condition: service_healthy
  #     cart-db:
  #       condition: service_healthy
  #     kafka:
  #       condition: service_healthy
  #   healthcheck:
  #     test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:9095/actuator/health"]
  #     interval: 20s
  #     timeout: 10s
  #     retries: 5
  #     start_period: 60s
  #   networks:
  #     - ecommerce-network
  #   restart: unless-stopped

  # ==================== NOTIFICATION SERVICE (COMMENT - CHẠY TRÊN INTELLIJ IDEA) ====================
  # notification-service:
  #   build:
  #     context: ./notification-service
  #     dockerfile: Dockerfile
  #   container_name: notification-service
  #   ports:
  #     - "8087:8080"
  #     - "9098:9098"
  #   environment:
  #     # Spring Profile
  #     SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-prod}
  #
  #     # Database Connection
  #     SPRING_DATASOURCE_URL: jdbc:mysql://notification-db:3306/notification_db?createDatabaseIfNotExist=true&allowPublicKeyRetrieval=true&useSSL=false&serverTimezone=Asia/Ho_Chi_Minh
  #     # Timezone Configuration
  #     TZ: Asia/Ho_Chi_Minh
  #     USER_TIMEZONE: Asia/Ho_Chi_Minh
  #     SPRING_DATASOURCE_USERNAME: root
  #     SPRING_DATASOURCE_PASSWORD: ${MYSQL_ROOT_PASSWORD:-rootpass}
  #
  #     # Eureka Discovery
  #     EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: http://eureka-server:8761/eureka/
  #     EUREKA_INSTANCE_PREFER_IP_ADDRESS: true
  #
  #     # JWT Configuration
  #     JWT_SECRET: ${JWT_SECRET}
  #     JWT_ACCESS_TOKEN_EXPIRATION: ${JWT_ACCESS_TOKEN_EXPIRATION:-3600}
  #     JWT_REFRESH_TOKEN_EXPIRATION: ${JWT_REFRESH_TOKEN_EXPIRATION:-86400}
  #
  #     # Gateway Security
  #     GATEWAY_SECRET: ${GATEWAY_SECRET}
  #
  #     # Kafka Configuration
  #     KAFKA_BOOTSTRAP_SERVERS: kafka:9093
  #   depends_on:
  #     eureka-server:
  #       condition: service_healthy
  #     notification-db:
  #       condition: service_healthy
  #     kafka:
  #       condition: service_healthy
  #   healthcheck:
  #     test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:9098/actuator/health"]
  #     interval: 20s
  #     timeout: 10s
  #     retries: 5
  #     start_period: 60s
  #   networks:
  #     - ecommerce-network
  #   restart: unless-stopped

  # ==================== API GATEWAY (COMMENT - CHẠY TRÊN INTELLIJ IDEA) ====================
  # api-gateway:
  #   build:
  #     context: ./api-gateway
  #     dockerfile: Dockerfile
  #   container_name: api-gateway
  #   ports:
  #     - "8080:8080"
  #     - "9090:9090"
  #   environment:
  #     # Spring Profile
  #     SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-prod}
  #
  #     # Eureka Discovery
  #     EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: http://eureka-server:8761/eureka/
  #     EUREKA_INSTANCE_PREFER_IP_ADDRESS: true
  #
  #     # JWT Configuration (PHẢI GIỐNG Auth Service)
  #     JWT_SECRET: ${JWT_SECRET}
  #     JWT_ACCESS_TOKEN_EXPIRATION: ${JWT_ACCESS_TOKEN_EXPIRATION:-3600}
  #
  #     # Gateway Security
  #     GATEWAY_SECRET: ${GATEWAY_SECRET}
  #   depends_on:
  #     eureka-server:
  #       condition: service_healthy
  #     auth-service:
  #       condition: service_healthy
  #     product-service:
  #       condition: service_healthy
  #     # cart-service:
  #     #   condition: service_healthy
  #     # notification-service:
  #     #   condition: service_healthy
  #     # order-service:
  #     #   condition: service_healthy
  #     # inventory-service:
  #     #   condition: service_healthy
  #   healthcheck:
  #     test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:9090/actuator/health"]
  #     interval: 20s
  #     timeout: 10s
  #     retries: 5
  #     start_period: 120s
  #   networks:
  #     - ecommerce-network
  #   restart: unless-stopped

  # ==================== PROMETHEUS ====================
  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    ports:
      - "9097:9090"
    volumes:
      - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus-data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--web.console.libraries=/usr/share/prometheus/console_libraries'
      - '--web.console.templates=/usr/share/prometheus/consoles'
      - '--storage.tsdb.retention.time=30d'
    networks:
      - ecommerce-network
    restart: unless-stopped

  # ==================== GRAFANA ====================
  grafana:
    image: grafana/grafana:latest
    container_name: grafana
    ports:
      - "3100:3000"
    environment:
      - GF_SECURITY_ADMIN_USER=admin
      - GF_SECURITY_ADMIN_PASSWORD=admin
      - GF_USERS_ALLOW_SIGN_UP=false
      - GF_INSTALL_PLUGINS=
    volumes:
      - grafana-data:/var/lib/grafana
      - ./grafana/dashboards:/etc/grafana/provisioning/dashboards
      - ./grafana/datasources:/etc/grafana/provisioning/datasources
    depends_on:
      - prometheus
    networks:
      - ecommerce-network
    restart: unless-stopped

volumes:
  auth-db-data:
    driver: local
  product-db-data:
    driver: local
  order-db-data:
    driver: local
  inventory-db-data:
    driver: local
  cart-db-data:
    driver: local
  notification-db-data:
    driver: local
  payment-db-data:
    driver: local
  redis_data:
    driver: local
  prometheus-data:
    driver: local
  grafana-data:
    driver: local

networks:
  ecommerce-network:
    driver: bridge